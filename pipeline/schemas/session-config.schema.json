{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cctvsim.io/schemas/session-config.json",
  "title": "Session Configuration",
  "description": "Configuration schema for CCTV Synthetic Data Generation Engine session",
  "type": "object",
  "required": ["sessionId", "totalFrames", "outputDirectory", "scenes", "cameras", "crowd", "timeWeather", "output"],
  "properties": {
    "sessionId": {
      "type": "string",
      "description": "Unique session identifier",
      "pattern": "^[a-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 64,
      "examples": ["session_factory_001", "test_session_20231027"]
    },
    "totalFrames": {
      "type": "integer",
      "description": "Total number of frames to generate",
      "minimum": 1,
      "maximum": 10000000,
      "examples": [100000, 500000, 1000000]
    },
    "outputDirectory": {
      "type": "string",
      "description": "Absolute path to output directory",
      "minLength": 1,
      "examples": ["/data/output", "C:\\output"]
    },
    "scenes": {
      "type": "array",
      "description": "List of scenes to use in sequence",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "$ref": "#/definitions/SceneConfig"
      }
    },
    "cameras": {
      "type": "array",
      "description": "Camera configurations",
      "minItems": 1,
      "maxItems": 6,
      "items": {
        "$ref": "#/definitions/CameraConfig"
      }
    },
    "crowd": {
      "$ref": "#/definitions/CrowdConfig"
    },
    "timeWeather": {
      "$ref": "#/definitions/TimeWeatherConfig"
    },
    "randomization": {
      "$ref": "#/definitions/RandomizationConfig"
    },
    "output": {
      "$ref": "#/definitions/OutputConfig"
    },
    "pipeline": {
      "$ref": "#/definitions/PipelineConfig"
    }
  },
  "definitions": {
    "SceneConfig": {
      "type": "object",
      "required": ["name", "durationFrames"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Scene name",
          "enum": ["Factory", "Office", "Warehouse", "Hospital", "Military"]
        },
        "durationFrames": {
          "type": "integer",
          "description": "Number of frames to generate in this scene",
          "minimum": 1
        }
      }
    },
    "CameraConfig": {
      "type": "object",
      "required": ["id", "resolution", "fov", "position", "rotation"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique camera identifier",
          "pattern": "^cam[0-9]{2}$",
          "examples": ["cam01", "cam02"]
        },
        "resolution": {
          "type": "string",
          "description": "Camera resolution in WxH format",
          "pattern": "^[0-9]+x[0-9]+$",
          "examples": ["1920x1080", "1280x720"]
        },
        "fov": {
          "type": "number",
          "description": "Horizontal field of view in degrees",
          "minimum": 30,
          "maximum": 120,
          "examples": [60, 70, 90]
        },
        "position": {
          "type": "array",
          "description": "Camera position in Unity world coordinates [x, y, z]",
          "items": {
            "type": "number"
          },
          "minItems": 3,
          "maxItems": 3,
          "examples": [[10, 5, -20]]
        },
        "rotation": {
          "type": "array",
          "description": "Camera rotation in Euler angles [pitch, yaw, roll]",
          "items": {
            "type": "number",
            "minimum": -180,
            "maximum": 180
          },
          "minItems": 3,
          "maxItems": 3,
          "examples": [[15, 180, 0]]
        },
        "sensorNoise": {
          "type": "object",
          "description": "Optional sensor noise parameters",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "gaussianStdDev": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.05
            }
          }
        }
      }
    },
    "CrowdConfig": {
      "type": "object",
      "required": ["minCount", "maxCount"],
      "properties": {
        "minCount": {
          "type": "integer",
          "description": "Minimum number of people in the scene",
          "minimum": 0,
          "maximum": 1000
        },
        "maxCount": {
          "type": "integer",
          "description": "Maximum number of people in the scene",
          "minimum": 1,
          "maximum": 1000
        },
        "behavior": {
          "type": "object",
          "properties": {
            "idleProbability": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.1
            },
            "walkSpeedRange": {
              "type": "array",
              "items": {
                "type": "number",
                "minimum": 0
              },
              "minItems": 2,
              "maxItems": 2,
              "default": [0.8, 1.5]
            },
            "groupMove": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "sizeRange": {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "minimum": 2
                  },
                  "minItems": 2,
                  "maxItems": 2,
                  "default": [3, 6]
                }
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "TimeWeatherConfig": {
      "type": "object",
      "required": ["timeOfDay"],
      "properties": {
        "timeOfDay": {
          "type": "string",
          "enum": ["day", "night", "sunrise", "sunset"],
          "description": "Time of day setting"
        },
        "brightness": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 1.0,
          "description": "Lighting brightness multiplier"
        },
        "weather": {
          "type": "string",
          "enum": ["clear", "rainy", "foggy", "snowy"],
          "default": "clear"
        }
      }
    },
    "RandomizationConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable domain randomization (Phase 2+)"
        },
        "brightnessRange": {
          "type": "array",
          "items": {
            "type": "number",
            "minimum": 0,
            "maximum": 2
          },
          "minItems": 2,
          "maxItems": 2,
          "default": [0.8, 1.2]
        },
        "colorTemperatureRange": {
          "type": "array",
          "items": {
            "type": "number",
            "minimum": 2000,
            "maximum": 10000
          },
          "minItems": 2,
          "maxItems": 2,
          "default": [4000, 8000]
        },
        "cameraNoiseLevel": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.05
        },
        "weatherPool": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["clear", "rainy", "foggy", "snowy"]
          },
          "uniqueItems": true,
          "default": ["clear"]
        }
      }
    },
    "OutputConfig": {
      "type": "object",
      "required": ["imageFormat", "labelFormats"],
      "properties": {
        "imageFormat": {
          "type": "string",
          "enum": ["jpg", "png"],
          "default": "jpg"
        },
        "labelFormats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["json", "yolo", "coco"]
          },
          "minItems": 1,
          "uniqueItems": true,
          "default": ["json"]
        },
        "reidDataset": {
          "type": "object",
          "description": "ReID dataset export options (Phase 2+)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "outputPath": {
              "type": "string",
              "description": "Path for ReID dataset (relative to outputDirectory)",
              "default": "reid_dataset"
            }
          }
        },
        "manifest": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "schemaVersion": {
              "type": "string",
              "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
              "default": "1.0.0"
            }
          }
        }
      }
    },
    "PipelineConfig": {
      "type": "object",
      "description": "Pipeline worker configuration (Phase 2+)",
      "properties": {
        "workerConcurrency": {
          "type": "object",
          "properties": {
            "capture": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 1
            },
            "detection": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            },
            "tracking": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4,
              "default": 1
            },
            "encode": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            },
            "storage": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            }
          }
        },
        "queueSize": {
          "type": "object",
          "properties": {
            "capture": {
              "type": "integer",
              "minimum": 64,
              "maximum": 4096,
              "default": 512
            },
            "detection": {
              "type": "integer",
              "minimum": 64,
              "maximum": 4096,
              "default": 512
            },
            "tracking": {
              "type": "integer",
              "minimum": 128,
              "maximum": 8192,
              "default": 2048
            },
            "encode": {
              "type": "integer",
              "minimum": 128,
              "maximum": 8192,
              "default": 2048
            },
            "storage": {
              "type": "integer",
              "minimum": 256,
              "maximum": 16384,
              "default": 4096
            }
          }
        },
        "checkpoint": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "intervalFrames": {
              "type": "integer",
              "minimum": 1000,
              "maximum": 100000,
              "default": 10000
            }
          }
        }
      }
    }
  }
}
