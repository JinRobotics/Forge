{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cctvsim.io/schemas/session-config.json",
  "title": "Session Configuration",
  "description": "Configuration schema for CCTV Synthetic Data Generation Engine session",
  "type": "object",
  "required": ["sessionId", "totalFrames", "outputDirectory", "scenes", "cameras", "crowd", "timeWeather", "output"],
  "properties": {
    "qualityMode": {
      "type": "string",
      "description": "Quality policy for frame drops and join timeouts",
      "enum": ["strict", "relaxed"],
      "default": "relaxed"
    },
    "sessionId": {
      "type": "string",
      "description": "Unique session identifier",
      "pattern": "^[a-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 64,
      "examples": ["session_factory_001", "test_session_20231027"]
    },
    "totalFrames": {
      "type": "integer",
      "description": "Total number of frames to generate",
      "minimum": 1,
      "maximum": 10000000,
      "examples": [100000, 500000, 1000000]
    },
    "outputDirectory": {
      "type": "string",
      "description": "Absolute path to output directory",
      "minLength": 1,
      "examples": ["/data/output", "C:\\output"]
    },
    "scenes": {
      "type": "array",
      "description": "List of scenes to use in sequence",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "$ref": "#/definitions/SceneConfig"
      }
    },
    "cameras": {
      "type": "array",
      "description": "Camera configurations",
      "minItems": 1,
      "maxItems": 6,
      "items": {
        "$ref": "#/definitions/CameraConfig"
      }
    },
    "crowd": {
      "$ref": "#/definitions/CrowdConfig"
    },
    "timeWeather": {
      "$ref": "#/definitions/TimeWeatherConfig"
    },
    "randomization": {
      "$ref": "#/definitions/RandomizationConfig"
    },
    "simulationGateway": {
      "$ref": "#/definitions/SimulationGatewayConfig"
    },
    "output": {
      "$ref": "#/definitions/OutputConfig"
    },
    "pipeline": {
      "$ref": "#/definitions/PipelineConfig"
    },
    "robotics": {
      "$ref": "#/definitions/RoboticsConfig"
    }
  },
  "definitions": {
    "SceneConfig": {
      "type": "object",
      "required": ["name", "durationFrames"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Scene name",
          "enum": ["Factory", "Office", "Warehouse", "Hospital", "Military"]
        },
        "durationFrames": {
          "type": "integer",
          "description": "Number of frames to generate in this scene",
          "minimum": 1
        }
      }
    },
    "CameraConfig": {
      "type": "object",
      "required": ["id", "resolution", "fov", "position", "rotation"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique camera identifier",
          "pattern": "^[a-zA-Z0-9_-]+$",
          "examples": ["cam01", "bot_cam_01"]
        },
        "resolution": {
          "type": "string",
          "description": "Camera resolution in WxH format",
          "pattern": "^[0-9]+x[0-9]+$",
          "examples": ["1920x1080", "1280x720"]
        },
        "fov": {
          "type": "number",
          "description": "Horizontal field of view in degrees",
          "minimum": 30,
          "maximum": 120,
          "examples": [60, 70, 90]
        },
        "position": {
          "type": "array",
          "description": "Camera position in Unity world coordinates [x, y, z]",
          "items": {
            "type": "number"
          },
          "minItems": 3,
          "maxItems": 3,
          "examples": [[10, 5, -20]]
        },
        "rotation": {
          "type": "array",
          "description": "Camera rotation in Euler angles [pitch, yaw, roll]",
          "items": {
            "type": "number",
            "minimum": -180,
            "maximum": 180
          },
          "minItems": 3,
          "maxItems": 3,
          "examples": [[15, 180, 0]]
        },
        "sensorNoise": {
          "type": "object",
          "description": "Optional sensor noise parameters",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "gaussianStdDev": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.05
            },
            "rollingShutter": {
              "type": "boolean",
              "default": false
            },
            "motionBlur": {
              "type": "object",
              "properties": {
                "exposureMs": {
                  "type": "number",
                  "minimum": 0,
                  "default": 16.7
                }
              }
            }
          }
        },
        "type": {
          "type": "string",
          "enum": ["static", "mobile"],
          "default": "static"
        },
        "mobile": {
          "$ref": "#/definitions/MobileCameraConfig"
        }
      }
    },
    "MobileCameraConfig": {
      "type": "object",
      "properties": {
        "path": {
          "type": "object",
          "required": ["waypoints"],
          "properties": {
            "waypoints": {
              "type": "array",
              "minItems": 2,
              "items": {
                "type": "object",
                "required": ["position"],
                "properties": {
                  "position": {
                    "type": "array",
                    "items": { "type": "number" },
                    "minItems": 3,
                    "maxItems": 3
                  },
                  "waitSeconds": {
                    "type": "number",
                    "minimum": 0,
                    "default": 0
                  }
                }
              }
            },
            "loop": { "type": "boolean", "default": false },
            "maxSpeed": { "type": "number", "minimum": 0.01, "default": 1.5 },
            "maxAngularSpeed": { "type": "number", "minimum": 0.1, "default": 45 },
            "navmeshArea": { "type": "string" }
          }
        },
        "controller": {
          "type": "object",
          "properties": {
            "positionGain": { "type": "number", "minimum": 0, "default": 1.0 },
            "rotationGain": { "type": "number", "minimum": 0, "default": 1.0 }
          }
        },
        "poseLogging": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "sampleRate": { "type": "number", "minimum": 0.01, "default": 30 },
            "output": { "type": "string" }
          }
        }
      }
    },
    "CrowdConfig": {
      "type": "object",
      "required": ["minCount", "maxCount"],
      "properties": {
        "minCount": {
          "type": "integer",
          "description": "Minimum number of people in the scene",
          "minimum": 0,
          "maximum": 1000
        },
        "maxCount": {
          "type": "integer",
          "description": "Maximum number of people in the scene",
          "minimum": 1,
          "maximum": 1000
        },
        "behavior": {
          "type": "object",
          "properties": {
            "idleProbability": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 0.1
            },
            "walkSpeedRange": {
              "type": "array",
              "items": {
                "type": "number",
                "minimum": 0
              },
              "minItems": 2,
              "maxItems": 2,
              "default": [0.8, 1.5]
            },
            "groupMove": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "sizeRange": {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "minimum": 2
                  },
                  "minItems": 2,
                  "maxItems": 2,
                  "default": [3, 6]
                }
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "TimeWeatherConfig": {
      "type": "object",
      "required": ["timeOfDay"],
      "properties": {
        "timeOfDay": {
          "type": "string",
          "enum": ["day", "night", "sunrise", "sunset"],
          "description": "Time of day setting"
        },
        "brightness": {
          "type": "number",
          "minimum": 0,
          "maximum": 2,
          "default": 1.0,
          "description": "Lighting brightness multiplier"
        },
        "weather": {
          "type": "string",
          "enum": ["clear", "rainy", "foggy", "snowy"],
          "default": "clear"
        }
      }
    },
    "RandomizationConfig": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable domain randomization (Phase 2+)"
        },
        "brightnessRange": {
          "type": "array",
          "items": {
            "type": "number",
            "minimum": 0,
            "maximum": 2
          },
          "minItems": 2,
          "maxItems": 2,
          "default": [0.8, 1.2]
        },
        "colorTemperatureRange": {
          "type": "array",
          "items": {
            "type": "number",
            "minimum": 2000,
            "maximum": 10000
          },
          "minItems": 2,
          "maxItems": 2,
          "default": [4000, 8000]
        },
        "cameraNoiseLevel": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.05
        },
        "weatherPool": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["clear", "rainy", "foggy", "snowy"]
          },
          "uniqueItems": true,
          "default": ["clear"]
        }
      }
    },
    "OutputConfig": {
      "type": "object",
      "required": ["imageFormat", "labelFormats"],
      "properties": {
        "imageFormat": {
          "type": "string",
          "enum": ["jpg", "png"],
          "default": "jpg"
        },
        "labelFormats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["json", "yolo", "coco"]
          },
          "minItems": 1,
          "uniqueItems": true,
          "default": ["json"]
        },
        "reidDataset": {
          "type": "object",
          "description": "ReID dataset export options (Phase 2+)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "outputPath": {
              "type": "string",
              "description": "Path for ReID dataset (relative to outputDirectory)",
              "default": "reid_dataset"
            },
            "sampleInterval": {
              "type": "integer",
              "description": "Sampling interval for frame crops (1 = every frame)",
              "minimum": 1,
              "default": 1
            },
            "maxSamplesPerPerson": {
              "type": "integer",
              "description": "Maximum samples per person (0 = no limit)",
              "minimum": 0,
              "default": 0
            },
            "metadataFields": {
              "type": "array",
              "description": "Metadata columns to emit alongside crops",
              "items": {
                "type": "string"
              },
              "uniqueItems": true,
              "default": [
                "global_person_id",
                "camera_id",
                "frame_id",
                "track_id",
                "scene_name",
                "occlusion",
                "visibility",
                "bbox_x",
                "bbox_y",
                "bbox_w",
                "bbox_h",
                "path"
              ]
            }
          }
        },
        "edgeExport": {
          "type": "object",
          "description": "Edge export artifact options (Phase 3+)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "formats": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["tfrecord", "npz", "onnx-bundle", "custom-binary"]
              },
              "uniqueItems": true,
              "default": []
            },
            "outputPath": {
              "type": "string",
              "description": "Path for edge export artifacts (relative to outputDirectory)",
              "default": "edge_packages"
            },
            "specVersion": {
              "type": "string",
              "description": "Edge artifact spec version",
              "pattern": "^[0-9]+\\.[0-9]+$",
              "default": "1.0"
            }
          }
        },
        "manifest": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "schemaVersion": {
              "type": "string",
              "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
              "default": "1.0.0"
            }
          }
        }
      }
    },
    "PipelineConfig": {
      "type": "object",
      "description": "Pipeline worker configuration (Phase 2+)",
      "properties": {
        "workerConcurrency": {
          "type": "object",
          "properties": {
            "capture": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 1
            },
            "detection": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            },
            "tracking": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4,
              "default": 1
            },
            "encode": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            },
            "storage": {
              "type": "integer",
              "minimum": 1,
              "maximum": 8,
              "default": 2
            }
          }
        },
        "queueSize": {
          "type": "object",
          "properties": {
            "capture": {
              "type": "integer",
              "minimum": 64,
              "maximum": 4096,
              "default": 512
            },
            "detection": {
              "type": "integer",
              "minimum": 64,
              "maximum": 4096,
              "default": 512
            },
            "tracking": {
              "type": "integer",
              "minimum": 128,
              "maximum": 8192,
              "default": 2048
            },
            "encode": {
              "type": "integer",
              "minimum": 128,
              "maximum": 8192,
              "default": 2048
            },
            "storage": {
              "type": "integer",
              "minimum": 256,
              "maximum": 16384,
              "default": 4096
            }
          }
        },
        "checkpoint": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "intervalFrames": {
              "type": "integer",
              "minimum": 1000,
              "maximum": 100000,
              "default": 10000
            }
          }
        }
      }
    },
    "SimulationGatewayConfig": {
      "type": "object",
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["inprocess", "remote", "distributed"],
          "default": "inprocess"
        },
        "host": { "type": "string", "default": "127.0.0.1" },
        "port": { "type": "integer", "minimum": 1, "maximum": 65535, "default": 8080 },
        "auth": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["none", "api-key", "mtls"], "default": "none" },
            "apiKeyEnv": { "type": "string" },
            "certPath": { "type": "string" },
            "keyPath": { "type": "string" }
          }
        },
        "allowedHosts": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["127.0.0.1"]
        }
      },
      "required": ["mode"]
    },
    "RoboticsConfig": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "backend": { "type": "string", "enum": ["isaac"], "default": "isaac" },
        "syncPolicy": {
          "type": "object",
          "properties": {
            "maxDelayMs": { "type": "integer", "minimum": 0, "default": 100 },
            "timeoutMs": { "type": "integer", "minimum": 1, "default": 5000 },
            "onTimeout": { "type": "string", "enum": ["skip", "abort"], "default": "skip" }
          }
        },
        "robotModel": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["differential_drive", "holonomic"] },
            "urdfPath": { "type": "string" },
            "initialPose": {
              "type": "object",
              "properties": {
                "x": { "type": "number", "default": 0 },
                "y": { "type": "number", "default": 0 },
                "z": { "type": "number", "default": 0 },
                "yaw": { "type": "number", "default": 0 }
              }
            }
          }
        },
        "lidar": { "$ref": "#/definitions/LidarConfig" },
        "imu": { "$ref": "#/definitions/ImuConfig" },
        "wheelOdom": { "$ref": "#/definitions/WheelOdomConfig" },
        "depth": { "$ref": "#/definitions/DepthCameraConfig" }
      }
    },
    "LidarConfig": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "model": { "type": "string" },
        "minRange": { "type": "number", "minimum": 0, "default": 0.1 },
        "maxRange": { "type": "number", "minimum": 0, "default": 50.0 },
        "verticalBeams": { "type": "integer", "minimum": 1, "default": 16 },
        "horizontalResolutionDeg": { "type": "number", "minimum": 0.01, "default": 0.2 },
        "rotationRateHz": { "type": "number", "minimum": 0.01, "default": 10 },
        "noise": {
          "type": "object",
          "properties": {
            "rangeStd": { "type": "number", "minimum": 0, "default": 0.02 },
            "intensityStd": { "type": "number", "minimum": 0, "default": 0.05 }
          }
        }
      }
    },
    "ImuConfig": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "updateRateHz": { "type": "number", "minimum": 1, "default": 100 },
        "noise": {
          "type": "object",
          "properties": {
            "accelStd": { "type": "number", "minimum": 0, "default": 0.02 },
            "gyroStd": { "type": "number", "minimum": 0, "default": 0.001 },
            "biasDriftStd": { "type": "number", "minimum": 0, "default": 0.0001 }
          }
        }
      }
    },
    "WheelOdomConfig": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "ticksPerRevolution": { "type": "integer", "minimum": 1, "default": 2048 },
        "wheelRadius": { "type": "number", "minimum": 0, "default": 0.1 },
        "baseWidth": { "type": "number", "minimum": 0, "default": 0.5 },
        "noise": {
          "type": "object",
          "properties": {
            "slipFactor": { "type": "number", "minimum": 0, "default": 0.05 }
          }
        }
      }
    },
    "DepthCameraConfig": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "resolution": {
          "type": "object",
          "properties": {
            "width": { "type": "integer", "minimum": 1, "default": 640 },
            "height": { "type": "integer", "minimum": 1, "default": 480 }
          }
        },
        "maxDepth": { "type": "number", "minimum": 0, "default": 20.0 },
        "fov": { "type": "number", "minimum": 1, "maximum": 180, "default": 90 }
      }
    }
  }
}
