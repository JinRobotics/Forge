
## 1. 목적

Forge Synthetic Data Engine의 보안 정책 및 법적 규정 준수 가이드를 제공한다.

**핵심 원칙**:
- 합성 데이터의 법적 지위 명확화
- 개인정보 보호 원칙 준수
- 안전한 시스템 운영
- 윤리적 사용 촉진

---

## 2. 데이터 보호

### 2.1 합성 데이터 vs 실제 데이터

**합성 데이터의 특징**:
- ✅ 실존 인물을 모사하지 않음
- ✅ 모든 얼굴, 의상, 신체는 3D 모델 기반 생성
- ✅ 실제 CCTV 영상을 사용하지 않음
- ✅ 개인정보가 포함되지 않음

**보장 사항**:
```
모든 생성 데이터는 100% 합성이며,
실존 인물의 초상권, 프라이버시를 침해하지 않습니다.
```

### 2.2 데이터 출처 명시

**Watermark 삽입**:
```json
// manifest.json에 명시
{
  "dataType": "synthetic",
  "generatedBy": "Forge v1.0",
  "disclaimer": "All persons appearing in this dataset are synthetic and do not represent real individuals.",
  "license": "CC BY 4.0"
}
```

**이미지 메타데이터**:
```csharp
// EXIF/XMP 메타데이터에 삽입
exif.AddTag(ExifTag.ImageDescription, "Synthetic Forge field camera image");
exif.AddTag(ExifTag.Copyright, "Generated by Forge");
exif.AddTag(ExifTag.Software, "Forge v1.0");
```

### 2.3 금지 사항

**❌ 절대 금지**:
1. 실존 인물의 얼굴 텍스처 사용
2. 실제 신분증, 번호판, 주소 등 개인정보 포함
3. 특정 인물을 의도적으로 모사하는 데이터 생성
4. 실제 CCTV 영상을 학습 데이터로 사용 (Unity 모델 제작 시)

**✅ 허용 사항**:
1. 일반적인 3D 모델 (Asset Store, 자체 제작)
2. 다양한 인종/성별/연령 분포
3. 공개 장소 (공장, 사무실 등)의 일반적 환경

### 2.4 Config/Log 민감 정보 필터링 표

| 구분 | 필터링 규칙 | 비고 |
| --- | --- | --- |
| API Key / Token | 저장/로그 전 삭제 또는 `***` 마스킹 | `config_json`, 로그, manifest 모두 동일 적용 |
| 사용자 경로/홈 디렉터리 | `/home/<user>` → `/home/***` | 경로 기반 식별 제거 |
| 머신 호스트명/IP | 필요 시만 저장, 그 외 `redacted` | `/status` 포함 상태 응답에서 제거 |
| 라이선스/비밀키 파일 경로 | 경로 자체를 저장하지 않음, ID만 저장 | DB에는 참조 키만 남김 |

필터링은 DAO/Repository/Logger 공통 유틸로 강제 적용해 편차를 줄인다.

---

## 3. 규정 준수

### 3.1 GDPR (EU General Data Protection Regulation)

**적용 여부**:
- 합성 데이터는 GDPR의 "개인정보"에 해당하지 않음
- 실존 인물을 식별할 수 없으므로 GDPR 적용 대상 아님

**단, 주의사항**:
- 생성 과정에서 사용된 메타데이터 (사용자 경로, 이름 등)는 보호 필요
- 로그 파일에 개인정보 기록 금지
- 온프레미스 환경에서 생성 시 데이터 격리

**준수 사항**:
```csharp
// 로그에서 민감 정보 제거
var sanitizedPath = path.Replace(Environment.UserName, "***");
_logger.LogInfo($"Saving to {sanitizedPath}");

// 사용자 정보 익명화
var userId = Environment.UserName;
var hashedId = ComputeHash(userId); // SHA256
manifest.GeneratedBy = $"User_{hashedId.Substring(0, 8)}";
```

### 3.2 AI Act (EU Artificial Intelligence Act)

**High-risk AI System에 사용 시 요구사항**:
1. **데이터 출처 투명성**:
   - manifest.json에 생성 엔진, 버전, 설정 명시
   - 재현 가능성: 동일 config로 동일 데이터 생성

2. **품질 검증**:
   - Validation Report 자동 생성
   - 손상률, 누락률 < 0.01%
   - Statistics 제공

3. **Documentation**:
   - 사용자 문서 (README, 설계문서)
   - 윤리 가이드라인

**준수 예시**:
```json
// manifest.json
{
  "aiActCompliance": {
    "category": "general-purpose",
    "riskLevel": "minimal",
    "documentation": "https://github.com/forge/docs",
    "validation": {
      "corruptionRate": 0.005,
      "missingLabelRate": 0.003,
      "qualityScore": 0.98
    }
  }
}
```

### 3.3 운영 시 상태 노출 최소화
- `/status` 등 상태 엔드포인트는 API Key/mTLS 등과 동일한 인증을 강제하고, 내부 대시보드 전용으로 한정한다.
- 워커별 큐 길이, 파일 경로, 사용자명 등 운영/개발자의 내부 정보는 노출하지 않는다(필요 시 요약 스칼라만 제공).
- 무인증 상태 조회는 금지하며, 로컬 바인딩 모드라도 외부 프런트엔드/브라우저에서 직접 호출하도록 열지 않는다.

### 3.3 한국 개인정보보호법

**적용 여부**:
- 합성 데이터는 개인정보에 해당하지 않음
- 특정인을 식별할 수 없으므로 법 적용 대상 아님

**윤리적 고려사항**:
- 생성 데이터가 특정 집단을 차별하지 않도록 다양성 확보
- 악의적 목적 (감시, 추적) 사용 금지 명시

---

## 4. 접근 제어 및 암호화

### 4.1 RBAC (Role-Based Access Control)

- **Role 계층**:
  - `viewer`: 세션/manifest 조회만 가능. `/status`(읽기), `/sessions/{id}` GET 허용.
  - `operator`: 세션 생성/중지 권한. `/session/init`, `/session/start`, `/session/stop` 허용.
  - `admin`: operator 권한 + Config 스키마 업데이트, Worker 등록, Audit 로그 열람.
- API Key/Bearer 토큰은 Role을 포함한 클레임을 갖도록 하고, HttpAuthMiddleware에서 Role 검사를 수행한다. (예: `X-Api-Key` → RBAC 매핑 테이블, `Authorization: Bearer` → JWT `role` 클레임)
- `/workers/*`, `/config/schema/*`, `/audit/*`는 반드시 `admin` Role로 제한한다.
- CLI/SDK는 `~/.forge/credentials.json`에서 Role과 스코프를 명시하고, 잘못된 Role로 호출 시 403을 반환한다.

### 4.2 암호화 저장 정책

- **정지 데이터(At-rest)**:
  - `session.db`(SQLite/PostgreSQL), `config_snapshots`, `audit_logs`는 OS 수준 암호화(disk encryption) 외에 필요 시 AES-256-GCM으로 추가 암호화한다.
  - Repository 레이어는 `ISecretStore`(Vault, KMS 등)를 통해 마스터 키를 로드하고, `config_json_encrypted` 컬럼을 선택적으로 사용한다.
  - 백업 파일(`sessions_backup.db`)은 `forge backup --encrypt --key <KMS-ARN>` 옵션으로 암호화 후 저장한다.
- **전송 데이터(In-transit)**:
  - `simulationGateway.mode=remote/distributed` 시 기본적으로 TLS(mTLS 권장)를 사용한다.
  - CLI ↔ Orchestration 통신에서도 HTTPS/gRPC-TLS만 허용하며, self-signed 인증서 사용 시 trust store에 사전 등록한다.

### 4.3 정책 적용 검증 (CI Integration)

- Test Strategy에 `SecurityChecks` job을 추가하여 다음을 검증한다:
  - ConfigSanitizer가 API Key/토큰/사용자 경로를 마스킹했는지 (`tests/unit/Application/ConfigurationLoaderTests`에 `ConfigSanitizer_SensitiveFieldsMasked` 추가).
- `/status` 계약 테스트가 Role 기반 접근을 강제하는지 (`tests/integration/StatusEndpointTests`에서 viewer Role로 POST 차단을 검증).
- RBAC 정책이 누락되지 않았는지 (`dotnet test tests/security`에서 허용되지 않은 조합 호출 시 403 기대).
- 암호화 플래그가 활성화된 세션에서 `config_json`가 평문으로 저장되지 않는지 (`tests/integration/EncryptedConfigTests`).
- GitHub Actions `pr.yml`에 `security-policy` job을 추가하고, 실패 시 `Security policy violation` 코멘트로 merge를 차단한다.

### 4.4 Scene Asset 업로드 보안
- **스토리지 구획**: 사용자 업로드 자산은 `assets/custom_scenes/` 하위의 `pending/`, `ready/`, `quarantine/` 디렉터리를 사용해 물리적으로 격리하고, 경로는 Config(`assetStorage.root`)로 재정의할 수 있다.
- **안티멀웨어 검사**: 업로드 직후 ClamAV 등 안티멀웨어 엔진과 Unity 호환성 검사(허용 확장자, NavMesh/조명 메타데이터 필수, 압축폭탄 탐지)를 실행하고, 실패 시 파일을 `quarantine/`으로 이동하며 사용자에게 재업로드 가이드를 제공한다.
- **리소스 제한**: 단일 업로드는 기본 10GB 이하, 파일 개수 10,000개 이하로 제한하고, 압축 해제 후 크기 검사/시간 제한으로 DoS를 방지한다.
- **권한 분리**: 검증/변환 Worker는 최소 권한 OS 계정으로 실행하며, 검증 완료 전까지 Scene Pool이나 Unity Runtime에서 해당 Asset을 로드하지 않는다.
- **감사 기록**: `scene_asset_audit.log`에 업로더, 파일 해시(SHA-256), 검사 결과, 격리 사유를 기록해 포렌식 추적이 가능하도록 한다.

---

## 5. 라이선스 및 저작권

### 5.1 생성 데이터 라이선스

**권장 라이선스**: Apache 2.0 또는 CC BY 4.0

**Apache 2.0**:
```
Copyright 2023 Forge

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.

You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
```

**CC BY 4.0**:
```
This dataset is licensed under the Creative Commons Attribution 4.0 International License.

You are free to:
- Share: copy and redistribute the material
- Adapt: remix, transform, and build upon the material

Under the following terms:
- Attribution: You must give appropriate credit
```

**manifest.json에 명시**:
```json
{
  "license": {
    "type": "CC BY 4.0",
    "url": "https://creativecommons.org/licenses/by/4.0/",
    "attribution": "Generated by Forge"
  }
}
```

### 4.2 Unity Asset 라이선스

**주의사항**:
- Unity Asset Store에서 구매한 3D 모델은 재배포 제한이 있을 수 있음
- 생성 데이터 재배포 시 Asset 라이선스 확인 필요

**검토 사항**:
1. Asset Store EULA 확인
   - "Rendered output" 재배포 허용 여부
   - 상업적 사용 허용 여부

2. 자체 제작 Asset 사용 권장
   - 또는 재배포 가능한 라이선스의 Asset 선택

3. 라이선스 정보 기록
   ```json
   {
     "assetLicenses": [
       {
         "assetName": "Factory Environment Pack",
         "license": "Unity Asset Store EULA",
         "redistributionAllowed": false
       }
     ]
   }
   ```

### 4.3 엔진 소프트웨어 라이선스

**Forge**:
- 오픈소스: Apache 2.0 (권장)
- 상용: Proprietary License (선택)

**의존성 라이브러리**:
- Unity: Unity Personal/Pro License
- .NET Libraries: MIT, Apache 2.0 등
- 모든 의존성 라이선스 준수 필요

---

## 5. 시스템 보안

### 5.1 네트워크 보안

**로컬 실행 (기본)**:
```csharp
// API 서버: localhost만 바인딩
var builder = WebApplication.CreateBuilder(args);
builder.WebHost.UseUrls("http://localhost:8080");

// 0.0.0.0 바인딩 금지 (외부 접근 차단)
```

**분산 실행 (Phase 3)**:
```csharp
// mTLS 적용
builder.Services.AddAuthentication()
    .AddCertificate(options =>
    {
        options.AllowedCertificateTypes = CertificateTypes.SelfSigned;
        options.ValidateCertificateUse = true;
    });

// 또는 API Key
builder.Services.AddAuthentication("ApiKey")
    .AddScheme<ApiKeyAuthenticationOptions, ApiKeyAuthenticationHandler>("ApiKey", null);
```

**방화벽 규칙**:
```bash
# 로컬 전용
sudo ufw allow from 127.0.0.1 to any port 8080

# 분산 환경 (특정 IP만)
sudo ufw allow from 192.168.1.0/24 to any port 8080
```

### 5.2 파일 시스템 보안

**권한 설정**:
```csharp
// 생성된 파일: 소유자만 읽기/쓰기
var fileMode = UnixFileMode.UserRead | UnixFileMode.UserWrite;
File.SetUnixFileMode(path, fileMode);

// 디렉토리: 소유자만 접근
Directory.CreateDirectory(sessionDir, UnixFileMode.UserRead | UnixFileMode.UserWrite | UnixFileMode.UserExecute);
```

**임시 파일 정리**:
```csharp
// 세션 종료 시 임시 파일 자동 삭제
public void Cleanup()
{
    var tempDir = Path.Combine(sessionDir, "temp");
    if (Directory.Exists(tempDir))
    {
        Directory.Delete(tempDir, recursive: true);
    }
}
```

### 5.3 로그 보안

**민감 정보 필터링**:
```csharp
public class SensitiveDataFilter : ILogEventFilter
{
    public bool IsEnabled(LogEvent logEvent)
    {
        // 경로에서 사용자명 제거
        logEvent.RenderMessage()
            .Replace(Environment.UserName, "***")
            .Replace(Environment.MachineName, "***");

        return true;
    }
}

// Serilog 설정
Log.Logger = new LoggerConfiguration()
    .Filter.With(new SensitiveDataFilter())
    .WriteTo.File("logs/session.log")
    .CreateLogger();
```

**로그 보관 정책**:
- 로컬 로그: 7일 후 자동 삭제
- 중요 로그 (에러): 30일 보관
- 장기 보관 시 암호화

### 5.4 의존성 보안

**정기적 업데이트**:
```bash
# NuGet 패키지 보안 취약점 스캔
dotnet list package --vulnerable

# 업데이트
dotnet add package PackageName --version x.y.z
```

**CI/CD 통합**:
```yaml
# .github/workflows/security-scan.yml
- name: Dependency vulnerability scan
  run: |
    dotnet list package --vulnerable --include-transitive
    if [ $? -ne 0 ]; then exit 1; fi
```

---

## 6. 데이터 격리

### 6.1 세션 간 격리

**디렉토리 분리**:
```
/output/
├── session_001/  (완전 격리)
├── session_002/  (완전 격리)
└── session_003/  (완전 격리)
```

**메모리 격리**:
- 각 세션은 독립적인 SessionContext 사용
- 세션 종료 시 모든 리소스 해제

### 6.2 멀티 테넌트 환경

**사용자별 격리**:
```
/output/
├── user_a/
│   ├── session_001/
│   └── session_002/
└── user_b/
    └── session_001/
```

**권한 관리**:
- 사용자는 자신의 디렉토리만 접근 가능
- 관리자만 전체 output 디렉토리 접근

---

## 7. 윤리적 사용 가이드

### 7.1 허용 용도

✅ **권장**:
- 안전/보안 시스템 개발·연구
- 감염병 동선 추적 시스템 사전 훈련
- 학술 연구 (MOT, ReID, Crowd Analysis)
- Edge AI 성능 검증 및 최적화
- 교육 목적

### 7.2 금지 용도

❌ **엄격히 금지**:
- 실제 개인 감시 목적 사용
- 특정 실존 인물 외형 모사 데이터 생성
- 차별적·악의적 목적의 데이터 생성·활용
- 법적 규제 회피 도구로 사용
- 허위 정보 (Deepfake 등) 생성

### 7.3 데이터 다양성 권고

**인종/성별/연령 균형**:
```json
// 권장 분포 (예시)
{
  "diversity": {
    "gender": {"male": 0.5, "female": 0.5},
    "ageGroup": {
      "young": 0.3,
      "middleAge": 0.5,
      "senior": 0.2
    },
    "ethnicity": {
      // 다양한 인종 분포
    }
  }
}
```

**과소·과대 표현 회피**:
- 특정 집단만 과도하게 등장하지 않도록 균형 유지
- Validation 단계에서 diversity score 측정

### 7.4 사용자 책임

**윤리 서약**:
```
사용자는 본 엔진 사용 시 다음을 준수해야 합니다:

1. 생성 데이터가 합성임을 명시
2. 실존 인물 모사 금지
3. 윤리적 목적으로만 사용
4. 소속 기관의 윤리 심의 통과 (필요 시)
5. 법적 규정 준수
```

---

## 8. 사고 대응 (Incident Response)

### 8.1 데이터 유출

**시나리오**: 합성 데이터가 외부에 유출

**대응**:
1. 즉시 확인: 어떤 데이터가 유출되었는가?
2. 합성 데이터임을 명시 (manifest.json 확인)
3. 실존 인물 포함 여부 검증
4. 필요 시 데이터 삭제 요청

**예방**:
- 생성 데이터에 watermark 삽입
- 민감 정보 포함하지 않기

### 8.2 무단 사용

**시나리오**: 생성 데이터가 금지 용도로 사용

**대응**:
1. 라이선스 위반 확인
2. 사용 중지 요청
3. 필요 시 법적 조치

**예방**:
- 명확한 라이선스 명시
- 금지 용도 안내

### 8.3 보안 취약점 발견

**절차**:
1. 취약점 리포트 접수 (security@forge.io)
2. 90일 이내 패치 발표
3. CVE 등록 (필요 시)
4. 사용자에게 업데이트 권고

---

## 9. 감사 (Audit) 및 컴플라이언스 체크

### 9.1 자체 감사 체크리스트

**데이터 품질**:
- [ ] 모든 데이터가 합성인가?
- [ ] 실존 인물 초상권 침해 없는가?
- [ ] 다양성 확보 (인종/성별/연령)?

**보안**:
- [ ] 로그에 민감 정보 없는가?
- [ ] 네트워크 접근 제어 적용?
- [ ] 의존성 취약점 없는가?

**규정 준수**:
- [ ] 라이선스 명시?
- [ ] manifest.json 생성?
- [ ] 윤리 가이드 제공?

### 9.2 외부 감사 대응

**요청 시 제공 자료**:
1. manifest.json (데이터 출처)
2. 설계문서 (생성 과정)
3. Validation Report (품질 검증)
4. 라이선스 정보
5. 윤리 가이드

---

## 10. 참고 자료

### 10.1 법률 및 규정
- [GDPR 공식 문서](https://gdpr.eu/)
- [EU AI Act](https://artificialintelligenceact.eu/)
- [한국 개인정보보호법](https://www.privacy.go.kr/)

### 10.2 보안 가이드
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CIS Benchmarks](https://www.cisecurity.org/cis-benchmarks/)

### 10.3 윤리 가이드
- [ACM Code of Ethics](https://www.acm.org/code-of-ethics)
- [IEEE Ethically Aligned Design](https://standards.ieee.org/industry-connections/ec/ead-v1/)

---

## 11. 연락처

**보안 문의**: security@forge.io (가상)
**윤리 문의**: ethics@forge.io (가상)
**일반 문의**: support@forge.io (가상)

**보안 취약점 리포트**:
- 비공개 이슈 또는 이메일
- PGP 키 제공 (필요 시)
- 90일 responsible disclosure 정책
